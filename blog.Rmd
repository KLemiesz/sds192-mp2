---
title: "Mini-Project 2"
author: "JiYoung Yun, Emma Utz, Katherine Lemiesz"
date: "March 26, 2017"
output: html_document
---

## Summary
Our visualization summarizes the average amount of a political contribution made by committees in each of the 50 states (and DC) for the 2012 elections. We then take the analysis a step further and generate a visual comparison of average contributions by the major parties in each of the states classified as “swing states” in 2012. 

```{r, message=FALSE, warning=FALSE, include=FALSE}
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(ggthemes)
```

```{r, include=FALSE}
load("committees.rda")
load("contributions.rda")
```

## Data wrangling
Group `contributions` data frame by committee ID and find average donation amount per committee.
```{r}
table1 <- contributions %>%
  group_by(cmte_id) %>%
  summarise(avg_contrib = mean(transaction_amt))
```

Select specific variables from the `committees` data frame for analysis.
```{r}
table2 <- committees %>%
  select(cmte_id, cmte_name, tres_name, cmte_state, cmte_party_affiliation, connected_org_name)
```

Join the restructured `table1` and `table2` by `cmte_id` (committee id).
```{r}
ourtable <- table2 %>%
  full_join(table1, by = "cmte_id")
glimpse(ourtable)
```

Get rid of rows without a specified party (NAs).
```{r}
newTable <- na.omit(ourtable)
glimpse(newTable)
```

Group the new data frame, `newTable`, by state and filter out non-states (donations were recieved from other areas, such as Puerto Rico which is designated by PR). Compute the average contribuation size per state, then arrange the table by descending contribution size.
```{r}
stateTable <- newTable%>%
  group_by(cmte_state)%>%
  summarise(stateAverage = mean(avg_contrib))%>%
  filter(cmte_state != "GU") %>%
  filter(cmte_state != "PR") %>%
  filter(cmte_state != "MP") %>%
  filter(cmte_state != "VI") %>%
  arrange(desc(stateAverage))
  
```

## Visualizations
Make a visualization of the state averages for comparison. We chose a bar graph because each state's contribution is independent of the other states' contributions. It is also an easy way to visually compare the states.
```{r}
stateAveragePlot <-ggplot(stateTable, aes(x = reorder(cmte_state, stateAverage), y = stateAverage, fill= stateAverage)) + geom_bar(stat = "identity") + coord_flip() + scale_color_hue()+ labs(title = "Average Committee Contribution by State", x="State", y = "State Average Contribution") 
stateAveragePlot
```

### Average Contributions by State
We hypothesized initially that swing states would be among those with the highest donation levels, since candidates are working on their campaigns more actively in those states and likely engaging with committees there, leading them to have a greater impact on the committees in those states and induce them to contribute funds (whether for or against). Therefore, an interesting conclusion from our first visualization was that 5 of the 9 officially recognized swing states in 2012 (namely, Nevada, Virginia, North Carolina, Ohio, and Iowa) were in the top 12 for average donations. This offers substantial support for our theory. We believe we may be able to gain more insight with future work looking also at total contributions.  

<br></br>
A pipeline function to find mean contributions by party affiliation:
```{r}
partyContribution <-function(state_arg) {
  newTable %>%
  select(Party = cmte_party_affiliation, State = cmte_state, Donations = avg_contrib) %>%
  group_by(Party) %>%
  filter(State == state_arg) %>%
  summarise(AvgDonations = mean(Donations))
}
```

Try applying the function to various states we're interested in based off our Average State Contribution data visualization:
```{r}
state_lst <- c("NV", "CO", "FL", "NH", "NC", "OH", "VA","WI","IA","ME")
lapply(state_lst, FUN = partyContribution)

```

Create a function that will plot the Average Donations by state as a bar chart:
```{r}
TryThis <-function(state_arg) {
  newTable %>%
  select(Party = cmte_party_affiliation, State = cmte_state, Donations = avg_contrib) %>%
  group_by(Party) %>%
  filter(State == state_arg) %>%
  summarise(AvgDonations = mean(Donations)) %>%
    ggplot(aes(x=Party, y=AvgDonations, fill= Party)) +
    geom_bar(stat="identity") + scale_color_manual(values = c(DEM = "blue", REP = "red", LIB = "green"))
}

```

Use lapply() to apply the plot function to the swing state list:
```{r}
swing_state_lst <- c("NV", "CO", "FL", "NH", "NC", "OH", "VA","WI","IA","ME")
lapply(swing_state_lst, FUN = TryThis)
```

## Conclusions and Insights
### Contributions in Swing States by Party
The most striking result of this analysis is that the largest average donations in most states were those with no party affiliation. In Nevada, Virginia, and Maine, the Republican party average was much higher than the others. We assume that this may be tied to the controversial intricacies of campaign finance. Many committees may not want to disclose their affiliation or preference for one party or another, as they may have to work with the "opponent" in the future if their candidate does not get elected. 